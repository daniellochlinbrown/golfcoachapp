# Render Blueprint for Golf Coach App
# Documentation: https://render.com/docs/blueprint-spec

services:
  # Web Service - Rails Application
  - type: web
    name: golfcoachapp
    runtime: docker
    plan: free  # Free tier - app spins down after 15 min of inactivity
    dockerfilePath: ./Dockerfile
    dockerContext: .

    # Health check endpoint
    healthCheckPath: /up

    # Environment variables
    envVars:
      # Rails environment
      - key: RAILS_ENV
        value: production

      # Rails master key (REQUIRED - add in Render dashboard)
      - key: RAILS_MASTER_KEY
        sync: false  # Must be set manually in Render dashboard

      # Claude API key (REQUIRED - add in Render dashboard)
      - key: CLAUDE_API_KEY
        sync: false  # Must be set manually in Render dashboard

      # Database connection (automatically set by Render when you link the database)
      - key: DATABASE_URL
        fromDatabase:
          name: golfcoachapp-db
          property: connectionString

      # Solid Queue runs in Puma process
      - key: SOLID_QUEUE_IN_PUMA
        value: true

      # Rails log level
      - key: RAILS_LOG_LEVEL
        value: info

      # Number of web workers (adjust based on plan)
      # Free tier has limited resources, so use 1 worker
      - key: WEB_CONCURRENCY
        value: 1

      # Rails serve static files (Render handles this, but good to enable)
      - key: RAILS_SERVE_STATIC_FILES
        value: true

      # Rails log to stdout (required for Render)
      - key: RAILS_LOG_TO_STDOUT
        value: true

databases:
  # PostgreSQL Database - Free Tier
  - name: golfcoachapp-db
    databaseName: golfcoachapp_production
    plan: free  # Free tier: 1GB storage, expires after 90 days
    # NOTE: Free tier limitations:
    #   - 1 GB storage
    #   - Database expires after 90 days (can be renewed)
    #   - You will need to create 3 additional databases manually:
    #     * golfcoachapp_production_cache (for Solid Cache)
    #     * golfcoachapp_production_queue (for Solid Queue)
    #     * golfcoachapp_production_cable (for Action Cable)
    # Instructions in RENDER_DEPLOYMENT.md

# Optional: Background Worker (if you want separate job processing)
# Uncomment this section if you need dedicated background workers
# - type: worker
#   name: golfcoachapp-worker
#   runtime: docker
#   dockerfilePath: ./Dockerfile
#   dockerContext: .
#   plan: starter
#   envVars:
#     - key: RAILS_ENV
#       value: production
#     - key: RAILS_MASTER_KEY
#       fromService:
#         type: web
#         name: golfcoachapp
#         envVarKey: RAILS_MASTER_KEY
#     - key: DATABASE_URL
#       fromDatabase:
#         name: golfcoachapp-db
#         property: connectionString
#   # Override CMD to run Solid Queue
#   startCommand: "bundle exec rake solid_queue:start"
